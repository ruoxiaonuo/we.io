class ValidationManager{static RULES={required:{validate:e=>null!=e&&""!==e.toString().trim(),message:"此项为必填项"},date:{validate:e=>!isNaN(new Date(e).getTime()),message:"请输入有效的日期"},minLength:t=>({validate:e=>e.length>=t,message:`最少需要${t}个字符`}),maxLength:t=>({validate:e=>e.length<=t,message:`最多允许${t}个字符`}),imageSize:t=>({validate:e=>e.size<=t,message:`图片大小不能超过${t/1024/1024}MB`}),imageType:{validate:e=>["image/jpeg","image/png","image/webp"].includes(e.type),message:"只支持 JPG、PNG、WEBP 格式的图片"}};static validateForm(e,t){var r,a,i={};for([r,a]of Object.entries(t)){var s,o=e[r];for(s of a){let e,t;if("string"==typeof s?e=this.RULES[s]:"function"==typeof s?e=s:[e,t]=s,!(t?this.RULES[e](t):e).validate(o)){i[r]=(t?this.RULES[e](t):e).message;break}}}return{isValid:0===Object.keys(i).length,errors:i}}static showErrors(e,t){t.querySelectorAll(".error-message").forEach(e=>e.remove()),t.querySelectorAll(".error-input").forEach(e=>{e.classList.remove("error-input")});for(var[r,a]of Object.entries(e)){var i,r=t.querySelector(`[name="${r}"]`);r&&(r.classList.add("error-input"),(i=document.createElement("div")).className="error-message",i.textContent=a,r.parentNode.insertBefore(i,r.nextSibling))}}static validateImage(a){return new Promise((e,t)=>{let r=new Image;r.onload=()=>{e({width:r.width,height:r.height,aspectRatio:r.width/r.height})},r.onerror=()=>t(new Error("图片加载失败")),r.src=URL.createObjectURL(a)})}static addFormValidation(i,s,o){i.addEventListener("submit",async e=>{e.preventDefault();var t,r,a={};for([t,r]of new FormData(i).entries())a[t]=r;e=this.validateForm(a,s);e.isValid?await o(a):this.showErrors(e.errors,i)}),i.addEventListener("input",e=>{var t,r,a=e.target.name;a&&s[a]&&(t=e.target.value,(t=this.validateForm({[a]:t},{[a]:s[a]})).isValid?((r=e.target.nextElementSibling)?.classList.contains("error-message")&&r.remove(),e.target.classList.remove("error-input")):this.showErrors({[a]:t.errors[a]},i))})}}