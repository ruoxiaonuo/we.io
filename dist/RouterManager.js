class RouterManager{static ROUTES={home:{path:"/",title:"我们的纪念日",template:"index.html"},calendar:{path:"/calendar",title:"日历 - 我们的纪念日",template:"calendar.html"},memory:{path:"/memory",title:"美好回忆 - 我们的纪念日",template:"memory.html"},photos:{path:"/photos",title:"照片墙 - 我们的纪念日",template:"photos.html"},fights:{path:"/fights",title:"吵架记录 - 我们的纪念日",template:"fights.html"}};constructor(){this.currentRoute=null,this.init()}init(){window.addEventListener("popstate",e=>{this.handleRoute(window.location.pathname,!1)}),document.addEventListener("click",e=>{e.target.matches("a")&&e.target.href.startsWith(window.location.origin)&&(e.preventDefault(),e=new URL(e.target.href).pathname,this.navigate(e))}),this.handleRoute(window.location.pathname,!1)}async handleRoute(t,e=!0){var a=Object.values(RouterManager.ROUTES).find(e=>e.path===t);if(a)try{LoadingManager.show(),document.title=a.title,this.updateNavigation(t),e&&window.history.pushState({},a.title,t);var n=await this.loadTemplate(a.template);document.getElementById("app").innerHTML=n,this.initPageModules(t)}catch(e){console.error("路由处理失败:",e),ErrorHandler.showError("页面加载失败，请重试")}finally{LoadingManager.hide()}else this.handle404()}async loadTemplate(e){var t,e=await fetch(e);if(e.ok)return e=await e.text(),(t=document.createElement("div")).innerHTML=e,t.querySelector("body").innerHTML;throw new Error("模板加载失败")}updateNavigation(t){document.querySelectorAll(".nav-links a").forEach(e=>{e.classList.toggle("active",e.pathname===t)})}initPageModules(e){switch(e){case"/calendar":new Calendar;break;case"/memory":new MemoryManager;break;case"/photos":new PhotoManager;break;case"/fights":new FightManager;break;case"/":new TimeManager(CONFIG.START_DATE)}}navigate(e){this.handleRoute(e)}handle404(){document.title="页面未找到",document.getElementById("app").innerHTML=`
            <div class="error-page">
                <h1>404</h1>
                <p>抱歉，页面未找到</p>
                <a href="/" class="back-home">返回首页</a>
            </div>
        `}static addRouteGuard(e){window.addEventListener("beforeunload",e)}}document.addEventListener("DOMContentLoaded",()=>{window.router=new RouterManager});