let CONFIG={START_DATE:"2024-01-29",UPDATE_INTERVAL:1e3,DATE_FORMAT:{year:"numeric",month:"2-digit",day:"2-digit"}};class TimeManager{constructor(e){this.startTimestamp=new Date(e).getTime(),this.updateIntervalId=null,this.init()}init(){try{this.startUpdating(),this.updateTime()}catch(e){console.error("初始化时间管理器失败:",e),this.handleError(e)}}startUpdating(){this.updateIntervalId&&clearInterval(this.updateIntervalId),this.updateIntervalId=setInterval(()=>this.updateTime(),1e3)}stopUpdating(){this.updateIntervalId&&(clearInterval(this.updateIntervalId),this.updateIntervalId=null)}calculateTimeDifference(e){e=Math.max(0,e-this.startTimestamp);return{days:Math.floor(e/864e5),hours:Math.floor(e%864e5/36e5),minutes:Math.floor(e%36e5/6e4),seconds:Math.floor(e%6e4/1e3)}}updateTime(){try{var e=new Date,t=e.getTime(),a=this.calculateTimeDifference(t),n=(this.updateElapsedTime(a),this.calculateNextAnniversary(e)),i=this.calculateRemainingTime(n);this.updateRemainingTime(i)}catch(e){console.error("更新时间失败:",e),this.handleError(e)}}calculateNextAnniversary(e){var t=e.getFullYear(),a=new Date(t,0,29);return a<e?new Date(t+1,0,29):a}calculateRemainingTime(e){var t=new Date,e=Math.max(0,e.getTime()-t.getTime());return{days:Math.floor(e/864e5),hours:Math.floor(e%864e5/36e5),minutes:Math.floor(e%36e5/6e4)}}updateElapsedTime(e){var t,a,n={days:document.getElementById("days"),hours:document.getElementById("hours"),minutes:document.getElementById("minutes"),seconds:document.getElementById("seconds")};for([t,a]of Object.entries(n))a&&(a.textContent=String(e[t]).padStart(2,"0"))}updateRemainingTime(e){var t,a,n,i={nextDays:document.getElementById("nextDays"),nextHours:document.getElementById("nextHours"),nextMinutes:document.getElementById("nextMinutes")};for([t,a]of Object.entries(i))a&&(n=e[t.replace("next","").toLowerCase()],a.textContent=String(n).padStart(2,"0"))}handleError(e){let t=document.createElement("div");t.className="error-message",t.textContent="时间更新出现错误，请刷新页面重试",document.body.appendChild(t),this.stopUpdating(),setTimeout(()=>{t.remove()},3e3)}}document.addEventListener("DOMContentLoaded",()=>{window.timeManager=new TimeManager("2024-01-29")}),document.addEventListener("visibilitychange",()=>{window.timeManager&&(document.hidden?window.timeManager.stopUpdating():window.timeManager.startUpdating())});